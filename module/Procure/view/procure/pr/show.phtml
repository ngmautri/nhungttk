
<h4><?php echo (!$entity == null)? $entity->getPrName():"";?></h4>

<div id="tabs" style="font-size: 9.5pt">
	<ul>
		<li><a href="#general">Purchase Request</a></li>
		<li><a
			href="/procure/pr-attachment/get-pictures?token=<?php echo (!$entity == null)? $entity->getToken():"";?>&checksum=<?php echo (!$entity == null)? $entity->getChecksum():"";?>&target_id=<?php echo (!$entity == null)? $entity->getID():"";?>">Picture</a></li>
		<li><a
			href="/procure/pr-attachment/list1?token=<?php echo (!$entity == null)? $entity->getToken():"";?>&checksum=<?php echo (!$entity == null)? $entity->getChecksum():"";?>&target_id=<?php echo (!$entity == null)? $entity->getID():"";?>">Attachment</a></li>

	</ul>

	<div id="general">

		<form id="Create_PR_Form" class="form-horizontal"
			action="/procure/pr/add" method="post" enctype="multipart/form-data">
			<input type="hidden" name="redirectUrl"
				value="<?php echo $redirectUrl ?>" />


			<fieldset>
				<legend style="font-size: 10pt; color: gray;">
					<small><span class="glyphicon glyphicon-triangle-right"></span></small>&nbsp;
					<a href="#pr_header" class="" data-toggle="collapse">PR HEADER:</a>
				</legend>
				<div id="pr_header" class="collapse">

					<div class="form-group">
						<label class="control-label col-sm-2">PR Number:</label>
						<div class="col-sm-3">
							<input class="form-control" type="text" placeholder=""
								name="prNumber"
								value="<?php echo (!$entity == null)? $entity->getPrNumber():"";?>">
						</div>

						<label class="control-label col-sm-1" for="inputTag"></label>
						<div class="col-sm-4">
							<input
								<?php if(!$entity == null): echo ($entity->getIsActive()=="1")?"checked":""; else: echo "checked"; endif;?>
								type="checkbox" name="isActive" value="1">&nbsp;Active&nbsp;&nbsp;
							<input
								<?php if(!$entity == null): echo ($entity->getIsDraft()== "1")?"checked":""; else: echo "checked"; endif;?>
								type="checkbox" name="isDraft" value="1">&nbsp;Draft&nbsp;&nbsp;

						</div>

					</div>

					<div class="form-group">
						<label class="control-label col-sm-2">PR Name:</label>
						<div class="col-sm-3">
							<input class="form-control" type="text" placeholder=""
								id="prName" name="prName"
								value="<?php echo (!$entity == null)? $entity->getPrName():"";?>">
						</div>

						<label class="control-label col-sm-2">Keywords:</label>
						<div class="col-sm-3">
							<input class="form-control" type="text" placeholder=""
								id="keywords" name="keywords"
								value="<?php echo (!$entity == null)? $entity->getKeywords():"";?>">
						</div>
					</div>

					<div class="form-group">
						<label class="control-label col-sm-2">Department</label>
						<div class="col-sm-3">
							<input disabled class="form-control" type="text"
								id="department_name" placeholder="Please select!"
								name="deparment_name"
								value="<?php if (!$entity== null):if($entity->getDepartment()!==null):echo $entity->getDepartment()->getNodeName(); endif;endif;?>">

							<input type="hidden" class="form-control" type="text"
								id="department_name_selected" placeholder="Please select!"
								name="department_id"
								value="<?php if (!$entity== null):if($entity->getDepartment()!==null):echo $entity->getDepartment()->getNodeId(); endif;endif;?>">
						</div>

						<a style="color: #0080ff;" href="javascript:;"
							onclick="showBootstrapDialog('Select Deparment','/application/department/list1','b_loaded_data');">Select&nbsp;&nbsp;<i
							class="glyphicon glyphicon-folder-open"></i>
						</a>
					</div>

					<div class="form-group">
						<label class="control-label col-sm-2">Remarks:</label>
						<div class="col-sm-3">
							<textarea class="form-control" type="text" rows="4"
								placeholder="" name="remarks" style="font-size: 9pt;"><?php echo (!$entity == null)? $entity->getRemarks():"";?></textarea>
						</div>
					</div>

					<div class="form-group">
						<label class="control-label col-sm-2" for="inputTag"></label>
						<div class="col-sm-3">
							<a class="btn btn-default"
								href="<?php echo $this->baseUrl ?>/procure/pr/edit?token=<?php echo (!$entity == null)? $entity->getToken():"";?>&entity_id=<?php echo (!$entity == null)? $entity->getId():"";?>&checksum=<?php echo (!$entity == null)? $entity->getChecksum():"";?>"><small><i
									class="glyphicon glyphicon-pencil"></i></small>&nbsp;Edit</a>

						</div>
					</div>

				</div>
			</fieldset>
		</form>
		
		
		<fieldset>
			<legend style="font-size: 10pt; color: gray;">
				<small><span class="glyphicon glyphicon-triangle-right"></span></small>&nbsp;
				<a href="#transaction" class="" data-toggle="collapse">PR ROWS:</a>
			</legend>
			<div id="transaction" class="collapse in">

				<div id="pr_rows"></div>
				<div id="pr_row_gird" style="margin: 1px;"></div>
		</fieldset>
		
		
		
	</div>


</div>



<script>

	//loadPrRow('<?php echo $this->baseUrl . '/procure/pr-row/row?target_id='. $entity->getId().'&token='.$entity->getToken().'&checksum='.$entity->getChecksum()?>');
	$("#Create_PR_Form :input").attr("disabled", "disabled");


	 //to check whether any row is currently being edited.
    function isEditing($grid) {
        var rows = $grid.pqGrid("getRowsByClass", { cls: 'pq-row-edit' });
        if (rows.length > 0) {
            //focus on editor if any 
            $grid.find(".pq-editor-focus").focus();
            return true;
        }
        return false;
    }

     
	  //called by add button in toolbar.
    function addRow($grid) {
    	 if (isEditing($grid)) {
    	        return false;
    	    }
    	  
    	//append empty row in the first row.                            
        var rowData = { Item: "", Quantity: 0, Received: 0, Balance: 0}; //empty row template
        $grid.pqGrid("addRow", { rowIndxPage: 0, rowData: rowData });

        var $tr = $grid.pqGrid("getRow", { rowIndxPage: 0 });
        if ($tr) {
            //simulate click on edit button.
            $tr.find("button.edit_btn").click();
        }
    }

    //var container_height = $('#main_container').height();
    //alert(container_height);
	var obj = { width: "100%", height: $(window).height()-350, showTitle : false,
			resizable:true,
			//draggable:true,
			sortable: true,
			hoverMode: 'cell',
			 pageModel: { type: "remote", rPP: 50, strRpp: "{0}" },
			 columnBorders: true,
			   toolbar: {
	                items: [
	                    { type: 'button', icon: 'ui-icon-plus', label: 'Add New Row', listeners: [
	                        { "click": function (evt, ui) {
	                            var $grid = $(this).closest('.pq-grid');
	                            //addRow($grid);
	                            
	    redirectUrl="/procure/pr-row/add?token=<?php echo (!$entity == null)? $entity->getToken():"";?>&target_id=<?php echo (!$entity == null)? $entity->getId():"";?>&checksum=<?php echo (!$entity == null)? $entity->getChecksum():"";?>";
       	//alert(rowData['item_name']);

          	//window.open(redirectUrl,'_blank');
	        window.location.href= redirectUrl;
	                             
	                            //debugger;
	                        }
	                        }
	                    ]
	                    }
	                ]
	            },  
	};

    obj.colModel = [
    	{ title: "SKU", dataType: "string", dataIndx: "item_sku", width:50,editable: false },
        { title: "Item", dataType: "string", dataIndx: "item_name", width:280,editable: false },
        { title: "Quantity", dataType: "integer", dataIndx: "quantity", width: 70,align: 'right',editable: false},
        { title: "Received", dataType: "string", dataIndx: "total_received", width:70, align: 'right',editable: false},
        { title: "Balance", dataType: "integer", dataIndx: "confirmed_balance", width: 70,align: 'right',editable: false},
        { title: "Project", dataType: "string", dataIndx: "project_id", width: 70, align: 'right',editable: false},
        { title: "Vendor", dataType: "string", dataIndx: "vendor_name", width: 90, align: 'left',editable: false},
        { title: "Price", dataType: "float", dataIndx: "vendor_unit_price", width: 82, align: 'right',editable: false},
        { title: "Curr", dataType: "string", dataIndx: "currency", width:3, align: 'center',editable: false},
             
        { title: "Remarks", dataType: "string", dataIndx: "remarks", align: 'left',minWidth: 150,editable: false},
        
        { title: "", editable: false, minWidth: 90, sortable: false,
            render: function (ui) {
                return "<button type='button' class='edit_btn'><small><i class='glyphicon glyphicon-pencil'>&nbsp;</i></small></button> <button type='button' class='receive_btn'><span class='glyphicon glyphicon-plus'>&nbsp;</span></button>";
	           }
        },
   ];

    obj.dataModel = {
    		  dataType: "JSON",
              location: "remote",
              method: "GET",
              recIndx: "row_id",
              url: "/procure/pr-row/gird?token=<?php echo (!$entity == null)? $entity->getToken():"";?>&target_id=<?php echo (!$entity == null)? $entity->getId():"";?>&checksum=<?php echo (!$entity == null)? $entity->getChecksum():"";?>",
              getData: function (response) {
           	    return { data: response.data, curPage: response.curPage, totalRecords: response.totalRecords};
             }
    };
    
    var $grid = $("#pr_row_gird").pqGrid(obj);

    $grid.on('pqgridrefresh pqgridrefreshrow', function () {
        //debugger;
        var $grid = $(this);

        //receive button
        $grid.find("button.receive_btn").button({})
        .unbind("click")
        .bind("click", function (evt) {

            var $tr = $(this).closest("tr"),
            rowIndx = $grid.pqGrid("getRowIndx", { $tr: $tr }).rowIndx;

            rowData = $grid.pqGrid("getRowData", { rowIndx: rowIndx }),
            recIndx = $grid.pqGrid("option", "dataModel.recIndx");
    
            redirectUrl="/inventory/item-transaction/gr?token="+rowData['row_token']+"&pr_row_id="+rowData['row_id']+"&checksum="+rowData['row_checksum'];
          	//alert(rowData['item_name']);
			
			window.location.href = redirectUrl;
          	//window.open(redirectUrl,'_blank');
        });

        //receive button
        $grid.find("button.edit_btn").button({})
        .unbind("click")
        .bind("click", function (evt) {

            var $tr = $(this).closest("tr"),
            rowIndx = $grid.pqGrid("getRowIndx", { $tr: $tr }).rowIndx;

            rowData = $grid.pqGrid("getRowData", { rowIndx: rowIndx }),
            recIndx = $grid.pqGrid("option", "dataModel.recIndx");
    
            redirectUrl="/procure/pr-row/edit?token="+rowData['row_token']+"&entity_id="+rowData['row_id']+"&checksum="+rowData['row_checksum'];
          	//alert(redirectUrl);
			window.location.href = redirectUrl;
          	//window.open(redirectUrl,'_blank');
        });
    });        

</script>

